# Plugins

Static software catalogs often suffer from a common problem: they become stale. While high-level metadata like ownership or lifecycle status changes slowly, technical details—such as deployed versions, API schemas, or build artifacts—evolve rapidly. Manually updating this information is impractical and error-prone.

Plugins in `swcat` solve this by automating the retrieval of dynamic information. They bridge the gap between your static catalog definitions and the living reality of your infrastructure.

## Concept

The plugin architecture enables a powerful data-enrichment loop:

1.  **Fetch:** A plugin connects to an external source (e.g., a CI/CD pipeline, an artifact repository, or a cloud provider) based on an entity's identity.
2.  **Enrich:** The plugin extracts relevant data and attaches it to the entity as **annotations**.
3.  **Visualize:** You use [Custom Content](custom-content.md) to render these annotations directly in the `swcat` UI, transforming raw data into useful insights (tables, links, or status indicators).

## Configuration

Plugins are configured in the `plugins.yml` file. Each plugin definition includes:

*   **Kind:** The type of plugin implementation (e.g., `AsyncAPIImporterPlugin`).
*   **Trigger:** A query predicate that determines which entities the plugin supports.
*   **Inhibit:** An optional predicate to prevent the plugin from running even if the trigger matches.
*   **Spec:** Plugin-specific configuration settings.

### Example `plugins.yml`

```yaml
plugins:
  asyncApiImporter:
    kind: AsyncAPIImporterPlugin
    trigger: "kind:API AND type~'^kafka/'"
    inhibit: "annotation='swcat/visibility=internal'"
    spec:
      targetAnnotation: asyncapi.com/channels
```

## Execution

When a plugin's trigger matches an entity, a "zap" (lightning bolt) icon appears on the entity's detail page in the `swcat` UI. Clicking this icon:

1.  Executes the applicable plugins.
2.  Collects the generated annotations.
3.  Saves the results into a [Sidecar Extension](sidecar-extensions.md) file.

## Available Plugins

`swcat` currently includes the following plugin types:

*   **AsyncAPIImporterPlugin:** Imports channel and message definitions from AsyncAPI specifications.
*   **ExternalPlugin:** Integrates external tools or scripts.

## External Plugins

The `ExternalPlugin` kind allows you to integrate any external tool or script into `swcat`. The tool runs as a subprocess, communicating with `swcat` via standard input (stdin) and standard output (stdout) using JSON.

### Configuration

Plugins are configured in `plugins.yml`.

| Field | Type | Description |
|---|---|---|
| `command` | `string` | **Required**. The executable to run (e.g., `java`, `python`, `node`, or a script path). |
| `args` | `[]string` | Command-line arguments passed to the executable. |
| `verbose` | `bool` | If `true`, logs input and output JSON payloads to the console for debugging. |
| `config` | `map` | Arbitrary key-value pairs passed to the plugin in the input JSON. |

Example:

```yaml
plugins:
  my-plugin:
    kind: ExternalPlugin
    spec:
      command: python3
      args: ["scripts/my_plugin.py"]
      verbose: true
      config:
        key: value
```

### Protocol

#### Input JSON (stdin)

The plugin receives a JSON object on stdin.

| Field | Type | Description |
|---|---|---|
| `entity` | `object` | The catalog entity being processed. Contains `metadata` and `spec`. |
| `config` | `map` | The configuration map defined in `plugins.yml` under `spec.config`. |
| `tempDir` | `string` | A temporary directory created for this plugin execution. Plugins should write any generated files here. |
| `args` | `map` | Runtime arguments passed to the plugin invocation (e.g. from previous plugins in a chain). |

Example Input:

```json
{
  "entity": {
    "metadata": {
      "name": "component-name",
      "namespace": "default",
      "annotations": { ... },
      "labels": { ... }
    },
    "spec": { ... }
  },
  "config": {
    "key": "value"
  },
  "tempDir": "/tmp/swcat-123abc",
  "args": { ... }
}
```

#### Output JSON (stdout)

The plugin must print a single JSON object to stdout. Any other output (logs, debug info) should be printed to **stderr**.

| Field | Type | Description |
|---|---|---|
| `success` | `bool` | **Required**. `true` if the operation succeeded, `false` otherwise. |
| `error` | `string` | Error message describing the failure. Required if `success` is `false`. |
| `generatedFiles` | `[]string` | A list of absolute paths to files generated by the plugin. Useful for chaining plugins. |
| `annotations` | `map` | A map of annotations (key-value pairs) to be added to the entity. Values must be valid JSON types. |

Example Output:

```json
{
  "success": true,
  "error": null,
  "generatedFiles": [
    "/tmp/swcat-123abc/plugin-subfolder/file1",
    "/tmp/swcat-123abc/plugin-subfolder/file2"
  ],
  "annotations": {
    "new/annotation": "value"
  }
}
```

### Example: Maven Artifact Extractor

A reference implementation is available in
[extensions/maven/](https://github.com/dnswlt/swcat/tree/main/extensions/maven/).
This Java application acts as an External Plugin that downloads artifacts from a Maven repository and extracts files from them.

Its
[Protocol.java](https://github.com/dnswlt/swcat/tree/main/extensions/maven/src/main/java/io/swcat/maven/protocol/Protocol.java)
contains example Java classes that model the JSON input and output.

---

!!! tip
    For details on how to visualize the annotations generated by plugins, see [Custom Content](custom-content.md).
